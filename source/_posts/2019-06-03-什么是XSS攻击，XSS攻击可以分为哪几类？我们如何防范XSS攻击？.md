---
title: '2019-06-03: 什么是XSS攻击，XSS攻击可以分为哪几类？我们如何防范XSS攻击？'
date: 2019-06-03 14:52:06
tags: [面试, web安全]
---

## 前言 
这是来自于参与刘小夕同学的GitHub项目的每日一题，[地址在此](https://github.com/YvetteLau/Step-By-Step/issues/18)，感兴趣的同学可以联系她哟～
今日的题目是“什么是XSS攻击，XSS攻击可以分为哪几类？我们如何防范XSS攻击？”， 以下是我的观点。

吐个小嘈，妈的，翻墙翻不出去了，折腾了好一会，委屈哭。

## xss
直接上谷歌上收的第一个链接点进去。xss是Cross-site Scripting的缩写。
这是一种攻击的方式，如果你想了解所有的攻击，请点击[所有的攻击](https://www.owasp.org/index.php/Category:Attack)
相信我，如果你有足够的时间再去看，因为我发现里面有13个子目录的攻击，太可怕了！
xss是c开头子目录里面的一种。

### xss是什么？
跨站点脚本（xss）攻击时一种注入类型，其中恶意代码被注入到其他良心和可信赖的网站中。当攻击者使用Web应用程序将恶意代码-通常以浏览器端脚本的形式发送给不同的终端用户，就会发生xss攻击。允许这些攻击成功的缺陷时非常容易传播的，而且发生在web应用程序在其输出的使用来自用户的输入而无需验证或者编码的地方。

一个攻击者可以使用XSS来发送恶毒的代码给毫无戒心的用户。终端的用户没办法知道这个脚本是否应该被信任，并且会去执行这个脚本。因为它认为这个脚本来自一个信任的源，恶毒的脚本可以活着任何的cookies,session tokens,或者其他被浏览器保存以及在这个网站是使用的敏感的信息。这些脚本甚至可以重写HTML网页的内容。有关不同类型的XSS漏洞的更多详细信息，请看：[Types of Cross-Site Scripting.
](https://www.owasp.org/index.php/Types_of_Cross-Site_Scripting)

#### 什么时候发生
1. 数据通过不受信任的来源进入Web应用程序，最常见的是Web请求。
2. 数据包含在动态内容中，该动态内容在未经过恶意内容验证的情况下发送给web用户。
恶毒的内容发送到浏览器通常通过脚本的片段，但是也可能包含HTML，FLASH，或者任何其他会让浏览器执行的代码的类型。基于XSS的各种攻击几乎是无限的，但它们通常包括传输私有数据，像cookie或其他会话信息一样被攻击者控制，将受害者重定向到攻击者控制的Web内容，或者在易受攻击的站点的幌子下在用户的机器上执行其他恶意操作。

#### 种类
XSS攻击可以简单的被分类称两种类型: stored and reflected.还有第三个，不太知名的XSS被称为基于DOM的XSS，这个会单独的讨论。
1. Stored XSS Attacks: 存储攻击是指注入的脚本永久存储在目标服务器上的攻击，例如数据库，消息论坛，访问者日志，注释字段等。受害者会从服务器获取到恶毒的脚本，当服务器请求了存储的信息。存储的XSS有时候也称之为持久性XSS或者Type-1 XSS.
2. Reflected XSS Attacks:反射攻击是指注入的脚本从Web服务器反射出来的攻击，例如：错误消息，搜索结果或包含作为请求的一部分发送到服务器的部分或全部输入的任何其他请求。反射的攻击通过另一条路径传递给受害者，例如在电子邮件中或其他一些网站上。当用户被欺骗点击恶意链接，提交特制表单，甚至只是浏览恶意网站时，注入的代码会传播到易受攻击的网站，这会将攻击反射回用户的浏览器。然后浏览器执行代码，因为它来自“可信”服务器。发射攻击有时候也称之为非持久性 XSS或者 Type-2 XSS.
3. 其他类型的XSS漏洞
基于DOM的XSS是Client XSS的子集。

#### 攻击后果
XSS攻击的后果是一样，无论是哪一种。区分就是有效负载如何到达服务器。不要认为“只读”或者“”宣传品“网站不容易收到严重反射的XSS攻击。XSS会给终端用户带来各种问题，从烦恼到账户完全泄漏。最严重的XSS攻击涉及披露用户的会话cookie，允许攻击者劫持用户的会话并接管帐户。其他破坏性攻击包括最终用户文件的泄露，特洛伊木马程序的安装，将用户重定向到其他页面或站点，或修改内容的呈现。

#### 如何确定你是否易攻击
XSS可能很难从一个web应用上识别并且一处。最好的办法找到缺陷就是最代码**执行安全性检查**，并搜索HTTP请求的输入可能对HTML输出的所有位置。请注意可以使用各种不同的HTML标记来传输脚本。Nessus，Nikto和其他一些可用的工具可以帮助扫描网站中的这些缺陷，但只能检查表面。如果网站的某个部分容易受到攻击，那么很可能还存在其他问题。

#### 如何防范 [参考地址](https://www.freebuf.com/articles/web/185654.html)
1. 对输入过滤
    * 防止HTML中出现注入
    * 防止JS执行时，执行恶意代码
2. 预防存储型和反射型攻击
    * 改成纯前端渲染，把数据和代码风格开
        1. 浏览器先加载一个静态 HTML，此 HTML 中不包含任何跟业务相关的数据。
        2. 然后浏览器执行 HTML 中的 JavaScript。
        3. JavaScript 通过 Ajax 加载业务数据，调用 DOM API 更新到页面上。     
    * 对HTML做充分转义
        如果拼接 HTML 是必要的，就需要采用合适的转义库，对 HTML 模板各处插入点进行充分的转义。
        常用的模板引擎，如 doT.js、ejs、FreeMarker 等，对于 HTML 转义通常只有一个规则，就是把 & < > " ' / 这几个字符转义掉，确实能起到一定的 XSS 防护作用，但并不完善。
3. 预防 DOM 型 XSS 攻击
    DOM 型 XSS 攻击，实际上就是网站前端 JavaScript 代码本身不够严谨，把不可信的数据当作代码执行了。  
    在使用 .innerHTML、.outerHTML、document.write() 时要特别小心，不要把不可信的数据作为 HTML 插到页面上，而应尽量使用 .textContent、.setAttribute() 等。  
    如果用 Vue/React 技术栈，并且不使用 v-html/dangerouslySetInnerHTML 功能，就在前端 render 阶段避免 innerHTML、outerHTML 的 XSS 隐患。   
    DOM 中的内联事件监听器，如 location、onclick、onerror、onload、onmouseover 等，a标签的 href 属性，JavaScript 的 eval()、setTimeout()、setInterval() 等，都能把字符串作为代码运行。如果不可信的数据拼接到字符串中传递给这些 API，很容易产生安全隐患，请务必避免。  
    



