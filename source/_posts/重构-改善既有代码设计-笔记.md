---
title: 重构-改善既有代码设计-笔记
date: 2019-04-02 14:06:45
tags: 编程思维
---
## 概念
重构与性能优化有很多相似之处：两者都需要修改代码，并且两者都不会改变程序的整体功能。两者的差别在于其目的：重构是为了让代码“更容易理解，更易于修改”。这可能使程序运行得更快，也可能使程序运行得更慢。在性能优化时，我只关心让程序运行得更快，最终得到的代码有可能更难理解和维护，对此我有心理准备。
程的帽子，我们会说，这个重构过程创造了一组部分应用函数（partially applied function）。

## 如何将重构带入自己的工作，遵守一下三次准则
1. 第一次做某件事时只管去做
2. 第二次做类似的事会产生反感，但无论如何还是可以去做
3. 第三次再做类似的事，你就应该重构

### 需要做一些处理的地方
1. 变量命名不合理的地方
2. 代码重复的地方
3. 过长函数的地方-封装成多个子函数调用
4. 过长参数列表的地方
5. 全局数据-防止被修改
6. 可变数据：如果要更新一个数据结构，就返回一份新的数据副本，旧的数据仍保持不变
7. 发散式变化：一旦需要修改，我们希望能够跳到系统的某一点，只在该处做修改。如果不能做到这一点，你就嗅出两种紧密相关的刺鼻味道中的一种了。
8. 霰弹式修改：如果每遇到某种变化，你都必须在许多不同的类内做出许多小修改，你所面临的坏味道就是霰弹式修改。如果需要修改的代码散布四处，你不但很难找到它们，也很容易错过某个重要的修改。

## 一些疑问

### 什么时候做重构最合适
预备性重构：在编码前做合适做重构，去看现有代码是否提供类似功能的函数

### 帮助理解的重构
先理解这段代码在干嘛，然后再去重构，使代码更易懂

### 捡垃圾式重构
看到有重复功能的代码，可以通过参数简化的，可以捡漏式的修改掉

### 如何抽取一个公共库
如果想替换掉一个正在使用的库，可以先引入一层新的抽象，使其兼容新旧两个库的接口。一旦调用方已经完全改为使用这层抽象，替换下面的库就会容易得多。（这个策略叫作Branch By Abstraction[mf-bba]。）




