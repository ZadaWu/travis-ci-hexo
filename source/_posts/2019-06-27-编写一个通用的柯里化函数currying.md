---
title: '2019-06-27:编写一个通用的柯里化函数currying'
date: 2019-06-27 13:47:00
tags: [Step-By-Step]
---

## 前言 
这是来自于参与刘小夕同学的GitHub项目的每日一题，[地址在此](https://github.com/YvetteLau/Step-By-Step/issues/33)，感兴趣的同学可以联系她哟～

## 编写柯里化函数currying

### 一些代码优化的地方[点击查看详情](https://llh911001.gitbooks.io/mostly-adequate-guide-chinese/content/ch2.html#%E4%B8%BA%E4%BD%95%E9%92%9F%E7%88%B1%E4%B8%80%E7%AD%89%E5%85%AC%E6%B0%91)
1. 函数优化1

    ```
    // 太傻了
    const getServerStuff = callback => ajaxCall(json => callback(json));
    
    // 这才像样
    const getServerStuff = ajaxCall;
    ```
    分析:
    
    ```
    // 这行
    ajaxCall(json => callback(json));
    
    // 等价于这行
    ajaxCall(callback);
    
    // 那么，重构下 getServerStuff
    const getServerStuff = callback => ajaxCall(callback);
    
    // ...就等于
    const getServerStuff = ajaxCall // <-- 看，没有括号哦
    ```

2. 写成一等公民函数的形式
    如果一个函数被不必要地包裹起来了，而且发生了改动，那么包裹它的那个函数也要做相应的变更。
    
    ```
    httpGet('/post/2', json => renderPost(json));
    ```
    如果 httpGet 要改成可以抛出一个可能出现的 err 异常，那我们还要回过头去把“胶水”函数也改了。
    
    ```
    // 把整个应用里的所有 httpGet 调用都改成这样，可以传递 err 参数。
    httpGet('/post/2', (json, err) => renderPost(json, err));
    ```
    写成一等公民函数的形式，要做的改动将会少得多：
    
    ```
    httpGet('/post/2', renderPost);  // renderPost 将会在 httpGet 中调用，想要多少参数都行
    ```

3. 正确地为参数命名也必不可少

    ```
    // 只针对当前的博客
    const validArticles = articles =>
      articles.filter(article => article !== null && article !== undefined),
    
    // 对未来的项目更友好
    const compact = xs => xs.filter(x => x !== null && x !== undefined);
    ```
    
4. 小心使用this,避免在底层函数使用this

    ```
    var fs = require('fs');
    
    // 太可怕了
    fs.readFile('freaky_friday.txt', Db.save);
    
    // 好一点点
    fs.readFile('freaky_friday.txt', Db.save.bind(Db));
    ```
    
5. 坚持使用纯函数
    纯函数秉持的概念是，输入有规则的得到输出。纯函数就是数学上的函数，而且是函数式编程的全部。使用这些纯函数编程能够带来大量的好处。
    * 纯函数总能够根据输入来做缓存
    * 可移植性强，自文档化。纯函数的依赖很明确，因为更易于观察和理解
    * 可测试性 （Quickcheck）
    * 合理性。保证总是返回同一个结果，这也就保证了引用透明性。
    * 并行代码：我们可以并行运行任意纯函数。因为纯函数根本不需要访问共享的内存，而且根据其定义，纯函数也不会因副作用而进入竞争态（race condition）。
    
### 什么是柯里化函数
curry 的概念很简单：只传递给函数一部分参数来调用它，让它返回一个函数去处理剩下的参数。
你可以一次性地调用 curry 函数，也可以每次只传一个参数分多次调用。

例子：

```
var add = function(x) {
  return function(y) {
    return x + y;
  };
};

var increment = add(1);
var addTen = add(10);

increment(2);
// 3

addTen(2);
// 12
```



